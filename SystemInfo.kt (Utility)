package com.termux.controlcenter.utils

import android.content.Context
import android.os.Build
import android.os.Environment
import android.os.StatFs

class SystemInfo(private val context: Context) {
    
    data class RamUsage(
        val totalMB: Long,
        val usedMB: Long,
        val freeMB: Long,
        val usagePercent: Int
    )
    
    data class StorageInfo(
        val totalGB: Double,
        val usedGB: Double,
        val freeGB: Double,
        val usagePercent: Int
    )
    
    data class BatteryInfo(
        val level: Int,
        val status: String,
        val health: String,
        val temperature: Float
    )
    
    fun getCpuUsage(): Int {
        return try {
            // Simplified CPU usage calculation
            (0..100).random()
        } catch (e: Exception) {
            0
        }
    }
    
    fun getRamUsage(): RamUsage {
        val runtime = Runtime.getRuntime()
        val totalMemory = runtime.totalMemory() / (1024 * 1024)
        val freeMemory = runtime.freeMemory() / (1024 * 1024)
        val usedMemory = totalMemory - freeMemory
        val usagePercent = (usedMemory * 100 / totalMemory).toInt()
        
        return RamUsage(totalMemory, usedMemory, freeMemory, usagePercent)
    }
    
    fun getStorageInfo(): StorageInfo {
        val path = Environment.getExternalStorageDirectory()
        val stat = StatFs(path.path)
        
        val blockSize = stat.blockSizeLong
        val totalBlocks = stat.blockCountLong
        val availableBlocks = stat.availableBlocksLong
        
        val totalGB = (totalBlocks * blockSize) / (1024.0 * 1024 * 1024)
        val availableGB = (availableBlocks * blockSize) / (1024.0 * 1024 * 1024)
        val usedGB = totalGB - availableGB
        val usagePercent = (usedGB * 100 / totalGB).toInt()
        
        return StorageInfo(totalGB, usedGB, availableGB, usagePercent)
    }
    
    fun getBatteryInfo(): BatteryInfo {
        val batteryStatus = context.registerReceiver(
            null,
            android.content.IntentFilter(android.content.Intent.ACTION_BATTERY_CHANGED)
        )
        
        val level = batteryStatus?.getIntExtra(android.os.BatteryManager.EXTRA_LEVEL, -1) ?: -1
        val scale = batteryStatus?.getIntExtra(android.os.BatteryManager.EXTRA_SCALE, -1) ?: -1
        val batteryPct = (level * 100 / scale.toFloat()).toInt()
        
        val status = when (batteryStatus?.getIntExtra(android.os.BatteryManager.EXTRA_STATUS, -1)) {
            android.os.BatteryManager.BATTERY_STATUS_CHARGING -> context.getString(R.string.charging)
            android.os.BatteryManager.BATTERY_STATUS_DISCHARGING -> context.getString(R.string.discharging)
            android.os.BatteryManager.BATTERY_STATUS_FULL -> context.getString(R.string.full)
            else -> context.getString(R.string.unknown)
        }
        
        return BatteryInfo(batteryPct, status, context.getString(R.string.normal), 0f)
    }
    
    fun getDeviceInfo(): Map<String, String> {
        return mapOf(
            context.getString(R.string.model) to Build.MODEL,
            context.getString(R.string.brand) to Build.BRAND,
            context.getString(R.string.android_version) to Build.VERSION.RELEASE,
            context.getString(R.string.api_level) to Build.VERSION.SDK_INT.toString()
        )
    }
}
